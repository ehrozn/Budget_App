// ==========================================
// CUSTOM CATEGORY MANAGEMENT
// ==========================================

// Available icons for categories (500+ options)
const AVAILABLE_ICONS = [
    'ðŸ”', 'ðŸ•', 'ðŸ—', 'ðŸŸ', 'ðŸŒ­', 'ðŸ¥ª', 'ðŸŒ®', 'ðŸŒ¯', 'ðŸ¥™', 'ðŸ¥—', 'ðŸ', 'ðŸœ', 'ðŸ²', 'ðŸ›', 'ðŸ£', 'ðŸ±', 'ðŸ¤', 'ðŸ™', 'ðŸš', 'ðŸ˜',
    'ðŸ¥', 'ðŸ¥Ÿ', 'ðŸ¢', 'ðŸ¡', 'ðŸ§', 'ðŸ¨', 'ðŸ¦', 'ðŸ¥§', 'ðŸ°', 'ðŸŽ‚', 'ðŸ®', 'ðŸ­', 'ðŸ¬', 'ðŸ«', 'ðŸ¿', 'ðŸ©', 'ðŸª', 'ðŸŒ°', 'ðŸ¥œ', 'ðŸ¯',
    'ðŸ¥›', 'ðŸ¼', 'â˜•', 'ðŸµ', 'ðŸ§ƒ', 'ðŸ¥¤', 'ðŸ¶', 'ðŸº', 'ðŸ»', 'ðŸ¥‚', 'ðŸ·', 'ðŸ¥ƒ', 'ðŸ¸', 'ðŸ¹', 'ðŸ¾', 'ðŸ§‰', 'ðŸ§Š',
    'ðŸš—', 'ðŸš•', 'ðŸš™', 'ðŸšŒ', 'ðŸšŽ', 'ðŸŽï¸', 'ðŸš“', 'ðŸš‘', 'ðŸš’', 'ðŸš', 'ðŸšš', 'ðŸš›', 'ðŸšœ', 'ðŸ›´', 'ðŸš²', 'ðŸ›µ', 'ðŸï¸', 'ðŸ›º', 'ðŸš”', 'ðŸš',
    'ðŸš˜', 'ðŸš–', 'ðŸš¡', 'ðŸš ', 'ðŸšŸ', 'ðŸšƒ', 'ðŸš‹', 'ðŸšž', 'ðŸš', 'ðŸš„', 'ðŸš…', 'ðŸšˆ', 'ðŸš‚', 'ðŸš†', 'ðŸš‡', 'ðŸšŠ', 'ðŸš‰', 'âœˆï¸', 'ðŸ›«', 'ðŸ›¬',
    'ðŸ›©ï¸', 'ðŸ’º', 'ðŸš', 'ðŸ›°ï¸', 'ðŸš€', 'ðŸ›¸', 'ðŸš¢', 'â›µ', 'ðŸ›¶', 'ðŸš¤', 'ðŸ›³ï¸', 'â›´ï¸', 'ðŸ›¥ï¸', 'ðŸš§', 'â›½', 'ðŸš', 'ðŸš¦', 'ðŸš¥',
    'ðŸ ', 'ðŸ¡', 'ðŸ˜ï¸', 'ðŸšï¸', 'ðŸ—ï¸', 'ðŸ­', 'ðŸ¢', 'ðŸ¬', 'ðŸ£', 'ðŸ¤', 'ðŸ¥', 'ðŸ¦', 'ðŸ¨', 'ðŸª', 'ðŸ«', 'ðŸ©', 'ðŸ’’', 'ðŸ›ï¸', 'â›ª', 'ðŸ•Œ',
    'ðŸ•', 'ðŸ›•', 'ðŸ•‹', 'â›©ï¸', 'ðŸ›¤ï¸', 'ðŸ›£ï¸', 'ðŸ—¾', 'ðŸŽ‘', 'ðŸžï¸', 'ðŸŒ…', 'ðŸŒ„', 'ðŸŒ ', 'ðŸŽ‡', 'ðŸŽ†', 'ðŸŒ‡', 'ðŸŒ†', 'ðŸ™ï¸', 'ðŸŒƒ', 'ðŸŒŒ', 'ðŸŒ‰',
    'ðŸ’¡', 'ðŸ”¦', 'ðŸ•¯ï¸', 'ðŸª”', 'ðŸ§¯', 'ðŸ›¢ï¸', 'ðŸ’¸', 'ðŸ’µ', 'ðŸ’´', 'ðŸ’¶', 'ðŸ’·', 'ðŸ’°', 'ðŸ’³', 'ðŸ’Ž', 'âš–ï¸', 'ðŸ§°', 'ðŸ”§', 'ðŸ”¨', 'âš’ï¸', 'ðŸ› ï¸',
    'â›ï¸', 'ðŸ”©', 'âš™ï¸', 'ðŸ§±', 'â›“ï¸', 'ðŸ§²', 'ðŸ”«', 'ðŸ’£', 'ðŸ§¨', 'ðŸ”ª', 'ðŸ—¡ï¸', 'âš”ï¸', 'ðŸ›¡ï¸', 'ðŸš¬', 'âš°ï¸', 'âš±ï¸', 'ðŸº', 'ðŸ”®', 'ðŸ“¿', 'ðŸ§¿',
    'ðŸ’Š', 'ðŸ’‰', 'ðŸ©¸', 'ðŸ©¹', 'ðŸ©º', 'ðŸŒ¡ï¸', 'ðŸ§¬', 'ðŸ¦ ', 'ðŸ§«', 'ðŸ§ª', 'ðŸ¥¢', 'ðŸ½ï¸', 'ðŸ´', 'ðŸ¥„', 'ðŸº',
    'ðŸ“±', 'ðŸ“²', 'â˜Žï¸', 'ðŸ“ž', 'ðŸ“Ÿ', 'ðŸ“ ', 'ðŸ”‹', 'ðŸ”Œ', 'ðŸ’»', 'ðŸ–¥ï¸', 'ðŸ–¨ï¸', 'âŒ¨ï¸', 'ðŸ–±ï¸', 'ðŸ–²ï¸', 'ðŸ’½', 'ðŸ’¾', 'ðŸ’¿', 'ðŸ“€', 'ðŸ§®', 'ðŸŽ¥',
    'ðŸŽžï¸', 'ðŸ“½ï¸', 'ðŸŽ¬', 'ðŸ“º', 'ðŸ“·', 'ðŸ“¸', 'ðŸ“¹', 'ðŸ“¼', 'ðŸ”', 'ðŸ”Ž', 'ðŸ®', 'ðŸ“”', 'ðŸ“•', 'ðŸ“–', 'ðŸ“—', 'ðŸ“˜',
    'ðŸ“™', 'ðŸ“š', 'ðŸ““', 'ðŸ“’', 'ðŸ“ƒ', 'ðŸ“œ', 'ðŸ“„', 'ðŸ“°', 'ðŸ—žï¸', 'ðŸ“‘', 'ðŸ”–', 'ðŸ·ï¸', 'ðŸ§¾',
    'ðŸ’¹', 'ðŸ’±', 'ðŸ’²', 'âœ‰ï¸', 'ðŸ“§', 'ðŸ“¨', 'ðŸ“©', 'ðŸ“¤', 'ðŸ“¥', 'ðŸ“¦', 'ðŸ“«', 'ðŸ“ª', 'ðŸ“¬', 'ðŸ“­', 'ðŸ“®', 'ðŸ—³ï¸', 'âœï¸', 'âœ’ï¸', 'ðŸ–‹ï¸', 'ðŸ–Šï¸',
    'ðŸ–Œï¸', 'ðŸ–ï¸', 'ðŸ“', 'ðŸ’¼', 'ðŸ“', 'ðŸ“‚', 'ðŸ—‚ï¸', 'ðŸ“…', 'ðŸ“†', 'ðŸ—’ï¸', 'ðŸ—“ï¸', 'ðŸ“‡', 'ðŸ“ˆ', 'ðŸ“‰', 'ðŸ“Š', 'ðŸ“‹', 'ðŸ“Œ', 'ðŸ“', 'ðŸ“Ž', 'ðŸ–‡ï¸',
    'ðŸ“', 'ðŸ“', 'âœ‚ï¸', 'ðŸ—ƒï¸', 'ðŸ—„ï¸', 'ðŸ—‘ï¸', 'ðŸ”’', 'ðŸ”“', 'ðŸ”', 'ðŸ”', 'ðŸ”‘', 'ðŸ—ï¸', 'ðŸ”¨', 'ðŸª“', 'â›ï¸', 'âš’ï¸', 'ðŸ› ï¸', 'ðŸ—¡ï¸', 'âš”ï¸', 'ðŸ”«',
    'ðŸ¹', 'ðŸ›¡ï¸', 'ðŸ”§', 'ðŸ”©', 'âš™ï¸', 'ðŸ—œï¸', 'âš–ï¸', 'ðŸ¦¯', 'ðŸ”—', 'â›“ï¸', 'ðŸ§°', 'ðŸ§²', 'âš—ï¸', 'ðŸ§ª', 'ðŸ§«', 'ðŸ§¬', 'ðŸ”¬', 'ðŸ”­', 'ðŸ“¡', 'ðŸ’‰',
    'ðŸ©¸', 'ðŸ’Š', 'ðŸ©¹', 'ðŸ©º', 'ðŸŒ¡ï¸', 'ðŸ§¹', 'ðŸ§º', 'ðŸ§»', 'ðŸš½', 'ðŸš°', 'ðŸš¿', 'ðŸ›', 'ðŸ›€', 'ðŸ§´', 'ðŸ§·', 'ðŸ§¼', 'ðŸ§½', 'ðŸ§¯', 'ðŸ›’',
    'ðŸ§', 'ðŸš®', 'ðŸš°', 'â™¿', 'ðŸš¹', 'ðŸšº', 'ðŸš»', 'ðŸš¼', 'ðŸš¾', 'ðŸ›‚',
    'ðŸ›ƒ', 'ðŸ›„', 'ðŸ›…', 'âš ï¸', 'ðŸš¸', 'â›”', 'ðŸš«', 'ðŸš³', 'ðŸš­', 'ðŸš¯', 'ðŸš±', 'ðŸš·', 'ðŸ“µ', 'ðŸ”ž', 'â˜¢ï¸', 'â˜£ï¸',
    'ðŸŽ®', 'ðŸ•¹ï¸', 'ðŸŽ°', 'ðŸŽ²', 'ðŸ§©', 'ðŸ§¸', 'ðŸŽ­', 'ðŸŽ¨', 'ðŸ§µ', 'ðŸ§¶', 'ðŸŽ¼', 'ðŸŽ¤', 'ðŸŽ§', 'ðŸŽ·', 'ðŸŽ¸', 'ðŸŽ¹', 'ðŸŽº', 'ðŸŽ»', 'ðŸ¥', 'ðŸŽ¬',
    'ðŸ†', 'ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', 'ðŸ…', 'ðŸŽ–ï¸', 'ðŸµï¸', 'ðŸŽ—ï¸', 'ðŸŽ«', 'ðŸŽŸï¸', 'ðŸŽª', 'ðŸ¤¹', 'ðŸŽ¯', 'ðŸŽ±', 'ðŸŽ³', 'ðŸŽ®', 'ðŸŽ°',
    'ðŸ‘•', 'ðŸ‘”', 'ðŸ‘—', 'ðŸ‘˜', 'ðŸ‘™', 'ðŸ‘š', 'ðŸ‘›', 'ðŸ‘œ', 'ðŸ‘', 'ðŸŽ’', 'ðŸ‘ž', 'ðŸ‘Ÿ', 'ðŸ‘ ', 'ðŸ‘¡', 'ðŸ‘¢', 'ðŸ‘‘', 'ðŸ‘’', 'ðŸŽ©', 'ðŸŽ“', 'ðŸ§¢',
    'â›‘ï¸', 'ðŸ“¿', 'ðŸ’„', 'ðŸ’', 'ðŸ’Ž', 'ðŸ”‡', 'ðŸ”ˆ', 'ðŸ”‰', 'ðŸ”Š', 'ðŸ“¢', 'ðŸ“£', 'ðŸ“¯', 'ðŸ””', 'ðŸ”•',
    'ðŸŽ', 'ðŸŽ€', 'ðŸŽŠ', 'ðŸŽ‰', 'ðŸŽˆ', 'ðŸŽ', 'ðŸŽ', 'ðŸ§§', 'âœ¨', 'ðŸŽ„', 'ðŸŽƒ', 'ðŸŽ—ï¸', 'ðŸ¥³', 'ðŸ¥‚',
    'âš½', 'ðŸ€', 'ðŸˆ', 'âš¾', 'ðŸ¥Ž', 'ðŸŽ¾', 'ðŸ', 'ðŸ‰', 'ðŸ¥', 'ðŸŽ±', 'ðŸ“', 'ðŸ¸', 'ðŸ’', 'ðŸ‘', 'ðŸ¥', 'ðŸ', 'ðŸ¥…', 'â›³', 'ðŸ¹', 'ðŸŽ£',
    'ðŸ¥Š', 'ðŸ¥‹', 'ðŸŽ½', 'ðŸ›¹', 'ðŸ›·', 'â›¸ï¸', 'ðŸ¥Œ', 'ðŸŽ¿', 'â›·ï¸', 'ðŸ‚', 'ðŸ‹ï¸', 'ðŸ¤¼', 'ðŸ¤¸', 'ðŸ¤º', 'â›¹ï¸', 'ðŸ¤¾', 'ðŸŒï¸', 'ðŸ‡', 'ðŸ§˜', 'ðŸŠ',
    'ðŸ¤½', 'ðŸš£', 'ðŸ§—', 'ðŸš´', 'ðŸšµ', 'ðŸŽ–ï¸', 'ðŸ†', 'ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', 'ðŸ…',
    'ðŸŒ', 'ðŸŒŽ', 'ðŸŒ', 'ðŸŒ', 'ðŸ—ºï¸', 'ðŸ—¾', 'ðŸ§­', 'ðŸ”ï¸', 'â›°ï¸', 'ðŸŒ‹', 'ðŸ—»', 'ðŸ•ï¸', 'ðŸ–ï¸', 'ðŸœï¸', 'ðŸï¸', 'ðŸžï¸',
    'ðŸŒ¸', 'ðŸ’®', 'ðŸµï¸', 'ðŸŒ¹', 'ðŸ¥€', 'ðŸŒº', 'ðŸŒ»', 'ðŸŒ¼', 'ðŸŒ·', 'ðŸŒ±', 'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸŒµ', 'ðŸŒ¾', 'ðŸŒ¿', 'â˜˜ï¸', 'ðŸ€', 'ðŸ', 'ðŸ‚',
    'ðŸƒ', 'ðŸ„', 'ðŸŒ°', 'ðŸ¦€', 'ðŸ¦ž', 'ðŸ¦', 'ðŸ¦‘', 'ðŸ™', 'ðŸš', 'ðŸŒ', 'ðŸ¦‹', 'ðŸ›', 'ðŸœ', 'ðŸ', 'ðŸž', 'ðŸ¦—', 'ðŸ•·ï¸', 'ðŸ•¸ï¸', 'ðŸ¦‚',
    'ðŸ¢', 'ðŸ', 'ðŸ¦Ž', 'ðŸ¦–', 'ðŸ¦•', 'ðŸ™', 'ðŸ¦‘', 'ðŸ¦', 'ðŸ¦ž', 'ðŸ¦€', 'ðŸ¡', 'ðŸ ', 'ðŸŸ', 'ðŸ¬', 'ðŸ³', 'ðŸ‹', 'ðŸ¦ˆ', 'ðŸŠ', 'ðŸ…', 'ðŸ†',
    'ðŸ¦“', 'ðŸ¦', 'ðŸ¦§', 'ðŸ˜', 'ðŸ¦›', 'ðŸ¦', 'ðŸª', 'ðŸ«', 'ðŸ¦’', 'ðŸ¦˜', 'ðŸƒ', 'ðŸ‚', 'ðŸ„', 'ðŸŽ', 'ðŸ–', 'ðŸ', 'ðŸ‘', 'ðŸ¦™', 'ðŸ', 'ðŸ¦Œ',
    'ðŸ•', 'ðŸ©', 'ðŸ¦®', 'ðŸ•â€ðŸ¦º', 'ðŸˆ', 'ðŸˆâ€â¬›', 'ðŸ“', 'ðŸ¦ƒ', 'ðŸ¦š', 'ðŸ¦œ', 'ðŸ¦¢', 'ðŸ¦©', 'ðŸ•Šï¸', 'ðŸ‡', 'ðŸ¦', 'ðŸ¦¨', 'ðŸ¦¡', 'ðŸ¦¦', 'ðŸ¦¥', 'ðŸ',
    'ðŸ€', 'ðŸ¿ï¸', 'ðŸ¦”', 'ðŸ¾', 'ðŸ‰', 'ðŸ²', 'ðŸŒµ', 'ðŸŽ„', 'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸŒ±', 'ðŸŒ¿', 'â˜˜ï¸', 'ðŸ€', 'ðŸŽ', 'ðŸŽ‹', 'ðŸƒ', 'ðŸ‚', 'ðŸ',
    'â­', 'ðŸŒŸ', 'âœ¨', 'âš¡', 'â˜„ï¸', 'ðŸ’¥', 'ðŸ”¥', 'ðŸŒªï¸', 'ðŸŒˆ', 'â˜€ï¸', 'ðŸŒ¤ï¸', 'â›…', 'ðŸŒ¥ï¸', 'â˜ï¸', 'ðŸŒ¦ï¸', 'ðŸŒ§ï¸', 'â›ˆï¸', 'ðŸŒ©ï¸', 'ðŸŒ¨ï¸', 'â„ï¸',
    'â˜ƒï¸', 'â›„', 'ðŸŒ¬ï¸', 'ðŸ’¨', 'ðŸ’§', 'ðŸ’¦', 'â˜”', 'â˜‚ï¸', 'ðŸŒŠ', 'ðŸŒ«ï¸'
];

// Load custom categories from localStorage
function loadCustomCategories() {
    const customCats = localStorage.getItem('customCategories');
    if (customCats) {
        const parsed = JSON.parse(customCats);
        state.customCategories = parsed;

        // Merge custom categories with default ones
        state.categories.expense = [
            ...state.categories.expense.filter(c => !c.custom),
            ...parsed.expense
        ];
        state.categories.income = [
            ...state.categories.income.filter(c => !c.custom),
            ...parsed.income
        ];
    }
}

// Save custom categories to localStorage
function saveCustomCategories() {
    localStorage.setItem('customCategories', JSON.stringify(state.customCategories));
}

// Open add category modal
function openAddCategoryModal() {
    const modal = document.getElementById('addCategoryModal');
    modal.classList.add('active');

    // Reset form
    document.getElementById('addCategoryForm').reset();
    document.getElementById('selectedIcon').value = '';

    // Populate icon picker
    populateIconPicker();
}

// Close add category modal
function closeAddCategoryModal() {
    document.getElementById('addCategoryModal').classList.remove('active');
}

// Populate icon picker with all available icons
function populateIconPicker() {
    const picker = document.getElementById('iconPicker');
    picker.innerHTML = AVAILABLE_ICONS.map(icon => `
    <div class="icon-option" data-icon="${icon}" onclick="selectIcon('${icon}')">
      ${icon}
    </div>
  `).join('');
}

// Select an icon
function selectIcon(icon) {
    // Remove previous selection
    document.querySelectorAll('.icon-option').forEach(opt => {
        opt.classList.remove('selected');
    });

    // Add selection to clicked icon
    const selected = document.querySelector(`[data-icon="${icon}"]`);
    if (selected) {
        selected.classList.add('selected');
        document.getElementById('selectedIcon').value = icon;
    }
}

// Filter icons based on search
function filterIcons() {
    const search = document.getElementById('iconSearch').value.toLowerCase();
    const icons = document.querySelectorAll('.icon-option');

    icons.forEach(icon => {
        const iconValue = icon.getAttribute('data-icon');
        // Simple filter - you could enhance this with emoji names/keywords
        if (search === '') {
            icon.classList.remove('hidden');
        } else {
            // For now, just show all since we don't have emoji names
            // In a real app, you'd map emojis to keywords
            icon.classList.remove('hidden');
        }
    });
}

// Handle add category form submission
function handleAddCategory(event) {
    event.preventDefault();

    const type = document.querySelector('input[name="categoryType"]:checked').value;
    const name = document.getElementById('categoryName').value.trim();
    const icon = document.getElementById('selectedIcon').value;
    const color = document.querySelector('input[name="categoryColor"]:checked').value;

    if (!icon) {
        showNotification('Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ!', 'error');
        return;
    }

    const category = {
        id: generateId(),
        name,
        icon,
        color,
        custom: true
    };

    // Add to state
    state.customCategories[type].push(category);
    state.categories[type].push(category);

    // Save to localStorage
    saveCustomCategories();

    // Close modal
    closeAddCategoryModal();

    // Update category options if transaction modal is open
    if (document.getElementById('addTransactionModal').classList.contains('active')) {
        updateCategoryOptions();
    }

    showNotification(`ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ "${name}" ÑÐ¾Ð·Ð´Ð°Ð½Ð°! ðŸŽ‰`);
}

// Add to initialization
document.addEventListener('DOMContentLoaded', () => {
    loadCustomCategories();
    init();
});

console.log('ðŸ’° Custom Categories Module loaded!');
console.log(`ðŸ“¦ Available icons: ${AVAILABLE_ICONS.length}`);
